document.domain="qq.com";var v20140624;
(function(a,g,n){function q(a){return a}function h(a){return decodeURIComponent(a.replace(l," "))}var l=/\+/g,b=a.cookie=function(c,e,f){if(e!==n){f=a.extend({},b.defaults,f);null===e&&(f.expires=-1);if("number"===typeof f.expires){var d=f.expires,k=f.expires=new Date;k.setDate(k.getDate()+d)}e=b.json?JSON.stringify(e):String(e);return g.cookie=[encodeURIComponent(c),"=",b.raw?e:encodeURIComponent(e),f.expires?"; expires="+f.expires.toUTCString():"",f.path?"; path="+f.path:"",f.domain?"; domain="+
f.domain:"",f.secure?"; secure":""].join("")}e=b.raw?q:h;f=g.cookie.split("; ");for(d=0;k=f[d]&&f[d].split("=");d++)if(e(k.shift())===c)return c=e(k.join("=")),b.json?JSON.parse(c):c;return null};b.defaults={domain:"qq.com",path:"/",expires:7};a.removeCookie=function(b,e){return null!==a.cookie(b)?(a.cookie(b,null,e),!0):!1}})(jQuery,document);
(function(a,g,n,q){var h,l,b="onfocusin"in g&&"hasFocus"in g?"focusin focusout":"focus blur",c=["","moz","ms","o","webkit"],e=n.support,f=n.event;for(;(l=h=c.pop())!=q;)if(l=(h?h+"H":"h")+"idden",e.pageVisibility="boolean"==typeof g[l]){b=h+"visibilitychange";break}n(/blur$/.test(b)?a:g).bind(b,function(a){var b=a.type;a=a.originalEvent;var c=a.toElement;(!/^focus./.test(b)||c==q&&a.fromElement==q&&a.relatedTarget==q)&&f.trigger((l&&g[l]||/^(?:blur|focusout)$/.test(b)?"hide":"show")+".visibility")})})(this,
document,jQuery);"undefined"!=typeof $&&$.noConflict&&"object"!=typeof jQuery&&$.noConflict();
jQuery(document).ready(function(){(function(a){var g=a(document);a(parent.document);a(window);var n=a("body"),q=null,h=h||parent.cmt_id,l="",l="www"==top.location.host.split(".")[0]?top.location.host.split(".")[1]:top.location.host.split(".")[0];a.widget("qq.comment",{options:{$content:a("#content"),$loginTrigger:a("#onekey"),$logoutTrigger:a("#loginOut"),$popReply:a("#public_reply"),$topReply:a("#top_reply"),$top_textarea:a("#top_textarea"),$allComments:a("#allComments"),$showNum:a("#showNum"),$commentTotleNum:a("#commentTotleNum"),
$loadMore:a("#loadMore"),fetchUrl:"http://coral.qq.com/",wfetchUrl:"http://w.coral.qq.com/",pfetchUrl:"http://pull.coral.qq.com/",topCallback:"parent.topCallback",popCallback:"parent.popCallback",reportCallback:"parent.reportCallback",deleteCallback:"parent.deleteCallback",$allComments:a("#tab1_allComments"),$myComments:a("#tab2_myComments"),$myTips:a("#tab3_tips"),$myCons:a("#tab4_mycon"),$loginFlag:a("#loginFlag"),$loginBtn:a("#top_post_btn"),$iframeHeight:"0",$replylistId:"",$myCowComment:a("#myCowComment"),
$myAllComment:a("#myAllComment"),$tabFlag:!0,$realtimeComments:0,$insertFlag:"comment",$nowDate:new Date,$urlapi:{userId:0,first:"",last:"",msgid:"",pageflag:0},$urlapi_mycomment:{userId:0,first:"",last:"",msgid:"",pageflag:0},loginuin:0,pubSucEvent:"commentpubsuccess",topContentTips:"",homePageSize:10,centerPageSize:10,loadPageSize:20,newsNum:0,hotNums:10,columSource:1,columsubSource:0,columCode:1,columApi:1,columLink:1,columHot:1,commentNumbers:"",popupInfo:"popClick",popupLink:"np-postlink",reportBtn:1,
centerFlag:0,changeFlag:0,reportId:"",hotPageSize:10,order:"",upId:"",siteName:"",lastId:"",huiyuan:0,film:0,client:0,postScroll:0},_create:function(){var b=this;this.init();this.changeTab();this.bindSubmitEvent();this.bindReportEvent();this.bindDeleteEvent();this.bindFooterEvent(this.options.$content);this.bindOtherEvents();this.loadCommentNum();this.hotList();this.makeCommentList();this.tabsComment();this.clickLoadMore();this.sendStat(l);this.initPostFrame();this.loadNum();this.element.bind(this.options.pubSucEvent,
function(c,e){b.insertTempComment(e.data.commentid,e.data.content,e.data.parent,e.data.time,e.data.checktype);b.options.$urlapi_mycomment.msgid=b.options.$urlapi_mycomment.first;b.options.columApi&&a("#mycon").hasClass("np-active")&&a("#myCowComment").hasClass("np-active")&&(b.options.$urlapi_mycomment.pageflag=0,b.loadMyComment());b.updateTime()})},init:function(){var b=this.options;a(parent.document).find("#commentIframe").css({"-webkit-transition":"height 0.6s ease",transition:"height 0.6s ease"});
a(parent.document).find("#commentIframe1")&&a(parent.document).find("#commentIframe1").css({"-webkit-transition":"height 0.6s ease",transition:"height 0.6s ease"});a("#mainBody").css("width","100%");b.commentNumbers=a(parent.document).find(".commentNumbers")?a(parent.document).find(".commentNumbers"):"";a("#allComments .post-list").length||a("#allComments").append("<ul class='post-list'></ul>");a("a").each(function(){a(this).attr("hideFocus","true")});if(parent.registerCoralEvent){parent.registerCoralEvent.source&&
(b.columSource=parent.registerCoralEvent.source);parent.registerCoralEvent.subsource&&(b.columsubSource=parent.registerCoralEvent.subsource);if(0==parent.registerCoralEvent.code||1==parent.registerCoralEvent.code)b.columCode=parent.registerCoralEvent.code;parent.registerCoralEvent.ownStyle&&a("head").append('<link href="'+parent.registerCoralEvent.ownStyle+'" rel="stylesheet" type="text/css" media="screen"/>');parent.registerCoralEvent.listHiden&&(a("#content").hide(),b.columApi=0,a(parent.document).find("#commentIframe").height(152));
parent.registerCoralEvent.commentNums&&(b.homePageSize=parent.registerCoralEvent.commentNums);0==parent.registerCoralEvent.commentLink&&(b.columLink=parent.registerCoralEvent.commentLink);2==parent.registerCoralEvent.commentLink&&(b.columLink=parent.registerCoralEvent.commentLink);0==parent.registerCoralEvent.commentHot&&(b.columHot=parent.registerCoralEvent.commentHot);parent.registerCoralEvent.commentHotNums&&(b.hotNums=parent.registerCoralEvent.commentHotNums);0==parent.registerCoralEvent.popupInfo&&
(b.popupInfo="popupInfoOff");0==parent.registerCoralEvent.popupLink&&(b.popupLink="popupLinkOff");0==parent.registerCoralEvent.reportBtn&&(b.reportBtn=0);0==parent.registerCoralEvent.commentPost&&(b.postScroll=1);parent.registerCoralEvent.site&&(b.siteName=parent.registerCoralEvent.site,"video"==parent.registerCoralEvent.site&&(b.huiyuan=1));parent.registerCoralEvent.site1&&(b.film=1);parent.registerCoralEvent.site2&&(b.client=1);if(top.location.host.match("coral.qq.com")){var c=top.location.host;
null!=c.match(/(\w+)\.coral\.qq\.com/)&&(b.fetchUrl="http://"+c.match(/(\w+)\.coral\.qq\.com/)[1]+".coral.qq.com/")}else void 0!=parent.registerCoralEvent.site&&(b.fetchUrl="http://"+parent.registerCoralEvent.site+".coral.qq.com/")}},creatHtml:function(b,c,e){var f=b.userinfo.head?b.userinfo.head:"http://mat1.gtimg.com/www/coral2.0/images/g.gif",d=b.userinfo.nick;b.content.replace(/\n/g,"<br />");b.userinfo.region.replace(/:/g," ");c=c?c:"";var k="",r="",u="",p="comment_",h="",g="popClick",l="v_qq_com.comment";
1==this.options.film&&(l="film_direct.comment");1==this.options.client&&(l="service.comment");"msg"==e&&(p="msg_",k="");"top"==e&&(p="top_",k="topIco np-label-digest",r="topAll");0==b.rep&&(u="topno");0<b.hotscale?h="":(b.userinfo.userid!=a.cookie("uid")&&this.options.reportBtn&&(h="<a href='javascript:void(0)' class='np-btn np-btn-report report' id='report_"+p+b.id+"'>\u4e3e\u62a5</a>"),k="");e=this.options.popupInfo;10001==b.replyuserid&&(g="");var m="",n="";b.rep&&(n="(<em>"+b.rep+"</em>)");if(""!=
b.content||0!=b.rep||0!=b.isdeleted||void 0!=b.picture){var q="",w="",x="",y="",z="";1==this.options.huiyuan&&(1==b.userinfo.hwvip&&(q="hyy",w="huiyuan p"+b.userinfo.hwlevel),1==b.replyhwvip&&(z="hyy",y="huiyuan p"+b.replyhwlevel),1==this.options.client||"none"==b.classNone)&&(x="vhidden");if(1==b.isdeleted)m+='<li class="np-post" id="'+p+b.id+'">',m=m+('<img class="np-avatar" src="'+f+'"alt="\u5934\u50cf"/>')+'<div class="np-post-body">',m+='<div class="np-post-header">',m+='<a href="javascript:void(0)" class="np-user">'+
d+"</a>",m+=0==b.parent?" ":'<a href="javascript:void(0)" post_uid = "'+b.replyuserid+'" class="replywho np-icon-reply-weak np-user '+g+'" style="display:'+b.classNone+'">'+b.replyuser+"</a>",m+='<span class="np-time" data="'+b.time+'" >'+this.formatTime(b.time)+"</span>",m+="</div>",m+='<div class="np-post-content padding-b"><p>\u6b64\u8d34\u5df2\u88ab\u7528\u6237\u5220\u9664</p></div>',m+="</div>",m+='<ul class="children"></ul>',m+="</li>";else if(2==b.checkstatus&&0!=b.rep)m+="<li class='postHide' id="+
p+b.id+"><ul class='children'></ul></li>";else{var A="";void 0!=b.picture&&b.picture.length&&(A='<div><img class="np-con-img" src="'+b.picture[0].url+'/150" /></div>');m+='<li class="np-post '+c+" "+k+" "+r+" "+u+' " id="'+p+b.id+'"><div class="np-tip-newpost"></div><img class="np-avatar '+e+'" post_uid ="'+b.userinfo.userid+'" src="'+f+'"alt="\u5934\u50cf"><div class="np-post-body"><div class="np-post-header">'+h+'<span class="'+q+'"><a href="javascript:void(0)" title="'+d+'" class="np-user '+e+
' " post_uid = "'+b.userinfo.userid+'">'+d+'</a><a href="http://film.qq.com/vip.html?ptag='+l+'" target = "_blank" class="'+w+'" title="\u4f1a\u5458\u5c0a\u4eab\u7ea2\u540d\u7279\u6743"></a></span>'+(0==b.parent?'<a href="javascript:void(0)" class="replywho np-icon-reply-weak np-user" style="display:none">'+b.replyuser+"</a>":'<span class="'+z+" "+x+'"><a href="javascript:void(0)" title="'+b.replyuser+'" post_uid = "'+b.replyuserid+'" class="replywho np-icon-reply-weak np-user '+g+' " style="display:'+
b.classNone+'">'+b.replyuser+'</a><a href="http://film.qq.com/vip.html?ptag='+l+'" target = "_blank" class="'+y+'"></a></span>')+'<span class="np-time" data="'+b.time+'" >'+this.formatTime(b.time)+'</span></div><div class="np-post-content"><p>'+b.content.replace(/\n/g,"<br />")+("topno"!=u&&"topAll"==r?this.creatPostLink(b):"")+"</p>"+A+'</div><div class="np-post-footer"><a href="javascript:void(0)" class="np-btn np-btn-upvote upvote" id=upvote_'+b.id+">(<em>"+b.up+'</em>)</a><a href="javascript:void(0)" class="np-btn np-btn-reply reply">\u56de\u590d'+
n+'</a><a href="javascript:void(0)" class="np-btn np-btn-newreply"></a></div></div><ul class="children"></ul></li>'}return m}},loadCommentNum:function(){var b=this,c=this.options;a.ajax({url:c.fetchUrl+"article/"+h+"/commentnum",dataType:"jsonp",jsonpCallback:"myHotcommentNum",beforeSend:function(){b._hotTimer0=(new Date).getTime()},success:function(a){0==a.errCode&&(c.commentNumbers.html(a.data.commentnum),c.$commentTotleNum.html("<span>"+a.data.commentnum+"\u6761\u8bc4\u8bba</span>"))}})},makeCommentList:function(){var b=
this,c=this.options;1==c.columLink?c.$commentTotleNum.attr("href",c.fetchUrl+h):(c.$commentTotleNum.attr("href","javascript:void(0)"),c.$commentTotleNum.removeAttr("target"),c.$commentTotleNum.css("cursor","default"),c.$commentTotleNum.css("text-decoration","none"));2==c.columLink&&(a("#globalNav h1").hide(),a("#globalNav").css("border-bottom","none"));a(parent.document.getElementById("cmtNum"))&&a(parent.document.getElementById("cmtNum")).attr({href:c.fetchUrl+h,target:"_blank"});c.columApi&&b.loadMore();
c.$loadMore.find("span").unbind().bind("click",function(){a("#loadMore>span").hide();a("#loadMore>em").addClass("np-load-more-loading").show();b.loadMore(c.lastId);0>=c.$loadMore.data("loadMoreNume")-c.homePageSize?(c.$loadMore.hide(),c.$loadMore.data("loadMoreNume",0)):c.$loadMore.data("loadMoreNume",c.$loadMore.data("loadMoreNume")-c.homePageSize);sendClientStat(l,1,h,"clk_allcomment_more")})},hotList:function(){var b=this,c=this.options,e=c.fetchUrl+"article/"+h+"/hotcomment?reqnum="+c.hotNums;
c.columHot&&a.ajax({url:e,dataType:"jsonp",jsonpCallback:"myHotcommentList",beforeSend:function(){b._hotTimer0=(new Date).getTime()},success:function(c){if(0==c.errCode){var d=(new Date).getTime();if(0!=c.data.commentid.length){var e=c.data.commentid.length;a.each(c.data.commentid,function(d,u){a("#allComments .post-list").prepend(b.creatHtml(c.data.commentid[e-d-1],0,"top"))});a.each(a("#allComments li.topAll"),function(b,c){b==e-1&&(a(this).addClass("noborder"),a(this).after('<li class="np-title-new">\u6700\u65b0\u8bc4\u8bba</li>'))});
a("#allComments .post-list").prepend('<li class="np-title-hot">\u70ed\u95e8\u8bc4\u8bba</li>');b.conHeight(5);setTimeout(function(){b.iframeHeight()},600)}}Qoss("zrpl",b._hotTimer0,{1:b._hotTimer0+1,2:d,3:d},100)}})},tabsComment:function(){var b=this,c=this.options;a("#mycon").unbind().click(function(){a(this).addClass("np-active");a("#mytips").removeClass("np-active");c.$myTips.hide();c.$myCons.show();0==a("#my-notification-list li").length&&(setTimeout(function(){b.loadMyComment()},500),a("#myuserInfo").hide());
sendClientStat(l,1,h,"clk_mycomment");b.iframeHeight()});a("#mytips").unbind().click(function(){a(this).addClass("np-active");a("#mycon").removeClass("np-active");c.$myTips.show();c.$myCons.hide();0==a("#my-message-list li").length&&b.loadMyMessage();sendClientStat(l,1,h,"clk_notice");b.iframeHeight()});""!=c.order&&(a("#order a").removeClass("np-active"),a("#order a[data-sort="+c.order+"]").addClass("np-active"));a("#order a").unbind().click(function(){"time"==a(this).attr("data-sort")?sendClientStat(l,
1,h,"clk_order_time"):sendClientStat(l,1,h,"clk_order_hot");a(this).hasClass("np-active")||(a("#order a").removeClass("np-active"),a(this).addClass("np-active"),a("#allComments .tipInfo").addClass("waitting").html("").show(),c.order="time"!=a(this).attr("data-sort")?a(this).attr("data-sort"):"",a("#allComments .post-list").html(""),a("#allComments .waitting").show(),c.$loadMore.hide(),"quality"!=c.order&&b.hotList(),setTimeout(function(){b.loadMore(0,1)},500))})},loadMore:function(b,c){function e(){0==
a("#allComments li").length&&a("#allComments").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u8bc4\u8bba").show();a("#allComments .post-list").length||a("#allComments").append("<ul class='post-list'></ul>")}var f=this,d=this.options;b=b||0;var k=d.homePageSize;b&&(k=20);a.ajax({url:d.fetchUrl+"article/"+h+"/comment?commentid="+b+"&reqnum="+k+"&tag="+d.order,dataType:"jsonp",beforeSend:function(){f._latestTimer0=(new Date).getTime()},error:e,jsonpCallback:"mainComment",success:function(c){if(0==
c.errCode){d.lastId=c.data.last;var k=(new Date).getTime();c.data.retnum<c.data.reqnum||c.data.total<=d.homePageSize?(a("#loadMore>span").hide(),a("#loadMore>em").removeClass("np-load-more-loading")):(a("#loadMore>span").show(),a("#loadMore>em").hide());d.$showNum.data("maxID",c.data.maxid);r(c);f.iframeHeight();b||(c.data.reqnum<c.data.total&&0<a("#allComments li").length&&d.$loadMore.show(),d.$commentTotleNum.html("<span>"+c.data.total+"\u6761\u8bc4\u8bba</span>"),d.commentNumbers.html(c.data.total),
a(parent.document.getElementById("cmtNum"))&&a(parent.document.getElementById("cmtNum")).html(c.data.total),a(parent.document.getElementById("cmtNum2"))&&a(parent.document.getElementById("cmtNum2")).html(c.data.total))}else e();0==a("#allComments li").length&&d.$loadMore.hide();Qoss("zxpl",f._latestTimer0,{1:f._latestTimer0+1,2:k,3:k},100)}});var r=function(b){b.data.commentid.length||0!=a("#allComments li").length?a("#allComments").children(".tipInfo").hide():(""!=d.order&&1!=c&&a("#order span[data-sort=time]").trigger("click"),
"quality"==d.order?a("#allComments").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u70ed\u8bc4").show():a("#allComments").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u8bc4\u8bba").show(),d.$loadMore.hide());a("#allComments .post-list").length||a("#allComments").append("<ul class='post-list'></ul>");a.each(b.data.commentid,function(b,c){0==c.parent||0==a("#comment_"+c.parent).length?(0==a("#comment_"+c.parent).length&&0!=c.parent?c.classNone="none":c.classNone=
"",a("#allComments .post-list").append(f.creatHtml(c))):(a("#comment_"+c.parent).hasClass("postHide")?c.classNone="none":c.classNone="",a("#comment_"+c.parent+">ul.children").append(f.creatHtml(c)))});a("#allComments .post-list .postHide").find(".replywho:first").hide();setTimeout(function(){f.conHeight()},300);setTimeout(function(){f.iframeHeight()},500)}},blueLine:function(b){setTimeout(function(){a(b+">.np-tip-newpost").animate({opacity:"0"},1E4);setTimeout(function(){a(b+">.np-avatar").animate({left:"0px"},
400);a(b+">.np-post-body").animate({"padding-left":"10px"},400);a(b).removeClass("blueflag")},8E3)},5E3)},probeEvent:function(){var b=this,c=this.options,e=function(){c.$tabFlag?a.ajax({url:"http://sync.coral.qq.com/t/"+h,dataType:"jsonp",jsonpCallback:"propNum",success:function(a){a>c.$realtimeComments&&0!=a&&(c.$realtimeComments=a,b.loadNew());setTimeout(function(){e()},3E4)},error:function(){setTimeout(function(){e()},3E4)}}):setTimeout(function(){e()},3E4);b.updateTime()};e()},loadNum:function(){var b=
this.options,c=a.cookie("uid"),e="http://sync.coral.qq.com/u/"+c+"?platform="+b.siteName;if(/^\d+$/.test(c+"")){var f=function(){b.$tabFlag&&a.cookie("uin")&&1E4<parseInt(c)?a.ajax({url:e,dataType:"jsonp",jsonpCallback:"userNum",success:function(b){0<b?a("#popMsg").html(b).show():a("#popMsg").html("").hide();setTimeout(function(){f()},3E4)},error:function(){setTimeout(function(){f()},3E4)}}):setTimeout(function(){f()},3E4)};f()}},loadNew:function(){var b=this,c=this.options;a.ajax({url:c.pfetchUrl+
"article/"+h+"/sync?lastid="+c.$showNum.data("maxID"),dataType:"jsonp",jsonpCallback:"newComment",timeout:3E4,success:function(e){b.options.$nowDate=1E3*e.info.time;if(0==e.errCode&&0!=e.data.length){e.data.maxid&&c.$showNum.data("maxID",e.data.maxid);a.each(e.data.commentid,function(e,d){if(0==a("#comment_"+d.id).length){if(2!=d.checkstatus){var k=c.$commentTotleNum.children("span").html();c.$commentTotleNum.children("span").html(parseInt(k)+1);c.commentNumbers.html(parseInt(k)+1)}0==d.parent?d.userinfo.userid!=
a.cookie("uid")&&(a("#hiddenCon").prepend(b.creatHtml(d)),k=a("#hiddenCon li"),a.each(k,function(b,c){a(c).addClass("blueflag")})):a.each(c.$allComments.find("li"),function(c,e){if(d.userinfo.userid!=a.cookie("uid")&&"comment_"+d.parent==e.id){void 0==a("#"+e.id).data("num")&&a("#"+e.id).data("num",0);if(a("#comment_"+d.parent).hasClass("undis")){var f=a("#comment_"+d.parent).parents("li:not(.undis):first");f.data("num",Number(f.data("num"))+1);var k=f.data("num")+"\u6761\u65b0\u56de\u590d",f=f.find(".post-footer:first>em.newcoment")}else a("#"+
e.id).data("num",Number(a("#"+e.id).data("num"))+1),k=a("#"+e.id).data("num")+"\u6761\u65b0\u56de\u590d",f=a(this).find(".post-footer:first>em.newcoment");f.html(k);f.show();a(e).find("ul:first").prepend(b.creatHtml(d,"undis"))}});a("#hiddenCon").html()&&d.parent&&(k=a("#hiddenCon li"),a.each(k,function(c,e){"comment_"+d.parent==e.id&&a(e).children(".children").append(b.creatHtml(d))}))}});if(e=a("#hiddenCon li").not(a(".hide")).length)a("#showNum span").html("<em>"+e+"</em> \u6761\u65b0\u8bc4\u8bba"),
a("#showNum").show().animate({height:"30px"},"slow",function(){b.iframeHeight()});a("#showNum").unbind().bind("click",function(){a("#allComments ul:first").prepend(a("#hiddenCon").html());a("#hiddenCon .blueflag").each(function(c,d){var e=a(this).attr("id");b.blueLine("#"+e)});a("#allComments li.temporary").remove();a("#hiddenCon").html("");a(this).hide();a("#allComments .tipInfo").hide();b.iframeHeight();c.newsNum=0;sendClientStat(l,1,h,"clk_newcomment_notice")});b.updateTime()}},error:function(a,
b,c){"timeout"==b&&setTimeout(function(){loadNewHtml()},5E3)}})},changeTab:function(){var b=this.options;a(document).bind({"show.visibility":function(){b.$tabFlag=!0},"hide.visibility":function(){b.$tabFlag=!1}})},bindFooterEvent:function(b){var c=this,e=this.options,f=a(".pop_reply"),d=a(".pop_reply a.submit"),k=a(".pop_reply textarea");b.delegate(".reply","click",function(e){e=e||window.event;var h=a(this).parents("li.np-post").attr("id");d.attr("id","pop_"+h);k.attr("id","pop_text_"+h);var p=a(this).closest(".np-post-body").next(".children");
p.find(".np-reply-box-footer a").removeClass("submitOn").addClass("submit").html("\u56de\u590d");p.find("textarea").val("");e.stopPropagation();p.has(".pop_reply").length&&"public_reply"==p.children().first().attr("id")?p.children(".pop_reply").is(":visible")?(p.children(".pop_reply").find(".commtSub").hide(),p.children(".pop_reply").slideUp("10",function(){c.iframeHeight()})):(p.children(".pop_reply").find(".commtSub").show(),p.children(".pop_reply").slideDown("100",function(){c.iframeHeight()}),
setTimeout(function(){p.children(".pop_reply").find("textarea").focus()},200)):(b.find(".pop_reply").slideUp("10",function(){a(this).remove();c.iframeHeight()}),p.prepend(f.clone()),p.children(".pop_reply").slideDown("100",function(){p.children(".pop_reply").find(".commtSub").show().animate({height:"48px"},"fast");c.iframeHeight()}),setTimeout(function(){p.children(".pop_reply").find("textarea").focus()},200));c.iframeHeight()});b.delegate(".pop_reply","click",function(a){a.stopPropagation()});b.delegate(".submit",
"click",function(){var b=c.getLoginStatus(),d=a(this).closest("[tid]").attr("tid");e.replylistId=a(this).attr("id").split("_")[2];0!=b?(c.checkAndPublish(this.id,d),e.$insertFlag=this.id.split("_")[1],sendClientStat(l,1,h,"pub_reply")):c.showLoginLayer()});b.delegate(".pop_user_login","click",function(){c.showLoginLayer()});a("#my-notification").delegate(".upvote","click",function(){alert("\u81ea\u5df1\u4e0d\u80fd\u9876\u81ea\u5df1");return!1});b.delegate(".upvote","click",function(){var b=a(this).attr("id"),
c=b.split("_")[1];e.uptId=b;if(a(this).hasClass("np-btn-active"))return!1;if(a.cookie("uid")==a(this).parent().parent().find(".np-user").attr("post_uid"))return alert("\u81ea\u5df1\u4e0d\u80fd\u9876\u81ea\u5df1"),!1;b=h;a(this).closest("[tid]").length&&(b=a(this).closest("[tid]").attr("tid"));a.ajax({url:e.wfetchUrl+"article/comment/up/to/"+c+"?targetid="+b,dataType:"jsonp",jsonpCallback:"ding",cache:!0,success:function(a){sendClientStat(l,1,h,"pub_up")}});c=a(this).find("em");b=parseInt(c.text());
c.html(b+1);a(this).addClass("np-btn-active")});b.delegate(".popClick","click",function(){a(this).attr("post_uid");var b=a(this).attr("post_uid");c.popupIframeLayer(b);sendClientStat(l,1,h,"clk_head")});b.delegate(".newcoment","click",function(){var b=a(this).attr("id").split("_")[1];a("#comment_"+b+">ul.children li .newcoment").hide();a("#comment_"+b+">ul.children li.undis").removeClass("undis").addClass("blueflag");c.iframeHeight();a(this).hide();a("#comment_"+b).data("num",0);a("#comment_"+b+">ul.children li.blueflag").each(function(b,
e){c.blueLine("#"+a(this).attr("id"))});sendClientStat(l,1,h,"clk_newreply_notice")});b.delegate(".spreadMoreBtn","click",function(){a(this).prev().css("height","");a(this).hide();c.iframeHeight()});b.delegate(".np-con-img","click",function(){a(this).unbind().bind("load",function(){c.iframeHeight()});var b=a(this).attr("src"),b=/\/150$/.test(b)?b.replace(/\/150$/,"/500"):b.replace(/\/500$/,"/150");a(this).attr("src",b);a(this).closest(".np-post-body").find(".spreadMoreBtn").click()})},showLoginLayer:function(){publicLoginEvent()},
loginEvent:function(b,c,e){var f="",f=c.replace(/</g,"&lt;"),f=f.replace(/>/g,"&gt;"),d=this.options;q=(""+b).match(/[1-9][0-9]*/)[0]||getUin();b=e?e:"http://mat1.gtimg.com/www/coral2.0/images/g.gif";d.$loginFlag.data("userPic",e);d.$loginFlag.data("nick",c);d.$loginBtn.html("\u53d1\u8868\u8bc4\u8bba");d.$loginFlag.find("img").attr("src",b);d.$loginFlag.find("em").html(f);a("#loginFlag span:first").removeClass();a("#loginFlag span:first a").removeClass();d.$loginFlag.show();a("#my-message .tipInfo").show();
a(".pop_user_login").hide();a("#public_reply .np-btn-submit").html("\u56de\u590d");this.options.$loginFlag.data("userPic",e);this.options.$loginFlag.data("nick",c);a("#my-message-list").html("");a("#my-notification-list").html("");a("#loadCmtMore").hide();this.options.loginuin&&this.options.$top_textarea.focus();this.iframeHeight();d.$urlapi_mycomment.msgid="";d.$urlapi.pageflag="0";d.$urlapi_mycomment.pageflag="0";this.changeUid();d.centerFlag&&d.$myCowComment.trigger("click");d.changeFlag&&(d.$myAllComment.trigger("click"),
this.reportInit(),a("#tab2_myComments .tipInfo").removeClass("waitting").addClass("waitting").html("").show(),a("#tab2_myComments .np-load-more").hide())},loginOut:function(b){var c=this.options;q=null;b||this.options.$logoutTrigger.click();c.$loginFlag.hide();a("#public_reply .np-btn-submit").html("\u767b\u5f55");c.$myAllComment.trigger("click");c.$loginBtn.html("\u767b\u5f55");a("#my-message-list").html("");a("#my-notification-list").html("");a("#loadCmtMore").hide();a("#loadMsgMore").hide();a.removeCookie("uid")},
changeUid:function(){var b=this.options,c="v_qq_com.comment";1==this.options.film&&(c="film_direct.comment");1==this.options.client&&(c="service.comment");a.ajax({dataType:"jsonp",url:b.fetchUrl+"user/0?&source=0",success:function(e){0==e.errCode&&1==b.huiyuan&&(1==e.data.hwvip?(a("#loginFlag span:first").addClass("hyw"),a("#loginFlag span.hyw a").addClass("huiyuan"),a("#loginFlag span.hyw a").attr("title","\u4f1a\u5458\u5c0a\u4eab\u7ea2\u540d\u7279\u6743"),a("#loginFlag .huiyuan").addClass("p"+e.data.hwlevel)):
(a("#loginFlag span:first").addClass("hyw0"),a("#loginFlag span.hyw0 a").addClass("huiyuan0"),a("#loginFlag span.hyw0 a").attr("title","\u5f00\u901a\u4f1a\u5458\u5c0a\u4eab\u8bc4\u8bba\u7ea2\u540d\u7279\u6743")),a("#loginFlag .huiyuan").attr("href","http://film.qq.com/vip.html?ptag="+c))},error:function(a){}})},getLoginStatus:function(){return q?1:0},bindSubmitEvent:function(){var b=this,c=this.options;c.$loginBtn.unbind().click(function(){getUin()&&"\u767b\u5f55"!=a(this).html()?(b.checkAndPublish(this.id),
c.$insertFlag="comment"):b.showLoginLayer()})},bindDeleteEvent:function(){var b=this;a("#mainBody").delegate(".delete","click",function(c){var e=a(this),f="popdelete",d=e.attr("id").split("_")[1];getUin()?(a("#my-notification-list li.np-post:last").attr("id")=="post_"+d&&(f="popdeletee"),a("#my-notification-list li.np-post").css("z-index","1"),a(".popdeletee").remove(),a(".popdelete").remove(),a("#post_"+d).css("z-index","100"),e.css("position","relative"),e.append('<div class="'+f+'"><h4>\u60a8\u786e\u5b9a\u8981\u6c38\u4e45\u5220\u9664\u6b64\u8bc4\u8bba\uff1f</h4><p><input class="cancel" type="button" value="\u53d6\u6d88" id="d_cancel"/><input class="confirm" type="button" value="\u786e\u5b9a" id="d_confirm"/></p></div>'),
a("#d_confirm").click(function(){b.postData(e.attr("id"),e.closest("[tid]").attr("tid"))}),a("#d_cancel").click(function(){e.find("div").remove();e.css("position","relative")})):b.showLoginLayer();c.stopPropagation()});g.unbind().bind("click",function(){a("#my-notification-list .delete div").remove()})},bindReportEvent:function(){var b=this,c=this.options,e=a(".np-report");a("#mainBody").delegate(".report","click",function(){var f=a(this);if(0!=b.getLoginStatus()){if(!a(this).find("em").length){a("#allComments .np-report").remove();
a("#allComments li.np-post").css("z-index","1");a(this).parent().append(e.clone().show());var d=a(this).attr("id").split("report_")[1];a("#"+d).css("z-index","100");a("#"+d).parents("li.np-post").css("z-index","100");a(this).attr("id").split("report_")[1]==a("#allComments li.np-post:last").attr("id")&&303>a("#allComments li.np-post:last .np-post-body:first").height()-37&&a("#allComments .np-report").css("top","-290px");a(this).attr("id").split("report_")[1]==a("#allComments li.np-post").eq(-2).attr("id")&&
303>a("#allComments li.np-post:last .np-post-body:first").height()+a("#allComments li.np-post").eq(-2).find(".np-post-body:first").height()-37&&a("#allComments .np-report").css("top","-290px");a(this).attr("id").split("report_")[1]==a("#allComments li.np-post").eq(-3).attr("id")&&303>a("#allComments li.np-post:last .np-post-body:first").height()+a("#allComments li.np-post").eq(-2).find(".np-post-body:first").height()+a("#allComments li.np-post").eq(-3).find(".np-post-body:first").height()-37&&a("#allComments .np-report").css("top",
"-290px");a(this).parent().find(".close").bind("click",function(){f.parent().find(".np-report").remove();a("#allComments li.np-post").css("z-index","1")});a(this).parent().find(".np-report-cancel").bind("click",function(){f.parent().find(".np-report").remove();f.parents(".np-post").trigger("mouseout");a("#allComments li.np-post").css("z-index","1")});a(this).parent().find("#impeach_desc").focus(function(){a(this).val("");a(this).css("color","#333")});a(this).parent().find(".np-report-submit").bind("click",
function(){f.parent().find("input[name='impeach_content']:checked").length?b.postData(f.attr("id"),f.closest("[tid]").attr("tid")):(0==f.parent().find(".np-report h5").find("span").length&&f.parent().find(".np-report h5").append('<span id="RT">\u4f60\u5fc5\u987b\u9009\u62e9\u4e00\u9879\u624d\u80fd\u4e3e\u62a5!</span>'),setTimeout(function(){a("#RT").remove()},2E3))});c.reportId=a(this).attr("id")}}else b.showLoginLayer()});a("#mainBody").delegate("li.np-post","mouseover",function(b){a(this).find("img:first").attr("post_uid")!=
a.cookie("uid")&&(a(".report").hide(),a(this).find(".report:first").show(),b.stopPropagation())});a("#mainBody").delegate(".np-post","mouseout",function(b){a(this).find(".report em").length||a(this).find(".report:first").hide();b.stopPropagation()})},reportInit:function(){var b=this.options.$allComments.find("li.np-post .reportOn");a.each(b,function(b,e){a(this).removeClass("reportOn");a(this).find("em").remove()})},checkAndPublish:function(b,c){var e=this.options,f=b.replace(/pop/,"pop_text"),f=
a("#"+f),d=b.split("_")[0];"top"==d&&(f=e.$top_textarea,sendClientStat(l,1,h,"pub_original"));0==a.trim(f.val()).length||f.val()==e.topContentTips?this.pubCallback(b,{ret:1,error2show:"\u8bf7\u8f93\u5165\u5185\u5bb9\uff01"}):2E3<a.trim(f.val()).realLength()?alert("\u8d85\u8fc71000\u4e2a\u5b57\u4e86"):getUin()?("top"==d&&e.$loginBtn.addClass("np-btn-submit-loading"),this.postData(b,c)):this.showLoginLayer()},postData:function(b,c){var e=this.options;this._pubTimer0=(new Date).getTime();var f=generateToken(getKey()),
d=b.replace(/pop/,"pop_text"),k=b.split("_")[2],r=b.split("_")[0],l=b.split("_")[2];b.split("_");var p=a("input[name='impeach_content']:checked").length?a("input[name='impeach_content']:checked").val():" ",g=a("#"+b).parent().find('input[name="impeach_desc"]').val();"top"==r?this.submitForm({targetid:h,type:1,format:"SCRIPT",callback:e.topCallback,content:a.trim(e.$top_textarea.val()),_method:"put",g_tk:f,code:1,source:e.columSource,subsource:e.columsubSource}):"pop"==r?(a("#"+b).html("").removeClass("submit").addClass("np-btn-submit-loading"),
this.submitForm({targetid:c||h,type:1,format:"SCRIPT",callback:e.popCallback,content:a.trim(a("#"+d).val()),_method:"put",g_tk:f,code:1,source:e.columSource,subsource:e.columsubSource},k)):"report"==r?this.submitForm({targetid:c||h,type:p,desc:g,enterapp:"web",_method:"put",commentid:l,format:"SCRIPT",g_tk:f,callback:e.reportCallback},r):"delete"==r&&this.submitForm({targetid:c||h,_method:"delete",format:"SCRIPT",g_tk:f,callback:e.deleteCallback},b)},submitForm:function(b,c){var e=this.options,f=
"",f=c?"report"==c||"msg"==c?"http://w.coral.qq.com/report/comment/0":"em"==c.split("_")[0]||"am"==c.split("_")[0]?e.wfetchUrl+"article/comment/up/to/"+c.split("_")[1]:"delete"==c.split("_")[0]?"http://w.coral.qq.com/article/comment/"+c.split("_")[1]:e.wfetchUrl+"article/comment/to/"+c:e.wfetchUrl+"article/comment/";a("#post_iframe").length||n.append('<iframe id="post_iframe" name="post_iframe" style="display:none"><script type="text/javascript">document.domain = "qq.com";\x3c/script></iframe>');
e=a("#_messageform").length?a("#_messageform").attr("action",f).empty():a('<form action="'+f+'" method="post" target="post_iframe" id="_messageform" style="display:none;"></form>').appendTo(n);for(name in b)e.append(a('<input name="'+name+'" type="hidden" value="" />').val(b[name]));e.submit()},sendStat:function(a){sendClientStat(l,2,h,"coral"==a?"pgv_commentdetail":"pgv_articledetail")},pubCallback:function(b,c,e){var f=b.split("_")[0],d=this.options,k=this,h="\u8bc4\u8bba\u6210\u529f!",l=!0,p=function(a){switch(a){case 0:k._trigger("pubsuccess",
null,c);break;case 8:k.showLoginLayer();break;case 9:case 13:case 14:case 16:case 17:k._trigger("pubsuccess",null,g);break;default:h="\u7cfb\u7edf\u51fa\u9519\u8bf7\u7a0d\u540e\u518d\u53d1"}};if("top"==f){if(c.ret)h=c.error2show||"<b>\u56e7</b>... \u51fa\u9519\u4e86\uff01 ",l=!1,setTimeout(function(){d.$top_textarea.focus();d.$topReply.find("span.np-tip-error").html(h).fadeOut("fast")},2E3);else{var g={data:{parent:"0",commentid:"222",time:"121212",content:""+k.encodeHTML(d.$top_textarea.val())+"",
checktype:"0"}};p(c.errCode);d.$loginBtn.removeClass("np-btn-submit-loading")}d.$topReply.find("span.np-tip-error").html(h).fadeIn("fast");l&&(d.$top_textarea.val(""),setTimeout(function(){d.$topReply.find("span.np-tip-error").hide();d.$topReply.find("span.fontsline").show()},2E3))}else if("pop"==f){var f=b.replace(/pop_/,""),n=a("#"+f+">.children .tips"),q=a("#content").find(".pop_reply:visible .np-tip-error"),m=a("#content").find(".pop_reply:visible textarea"),t=b.replace(/pop/,"pop_text");c.ret?
(tips=c.error2show||"<b>\u56e7</b>... \u51fa\u9519\u4e86\uff01 ",n.html(tips).hide().fadeIn("slow"),setTimeout(function(){a("#"+t).focus();n.html("")},2E3)):(g={data:{parent:d.replylistId,commentid:"222",time:"\u521a\u521a",content:k.encodeHTML(a(m).val()),checktype:"0"}},p(c.errCode),q.html(h).hide().fadeIn("slow"),a("#content").find(".pop_reply:visible .np-reply-box-footer a").removeClass("submitOn").addClass("submit").html("\u56de\u590d"),setTimeout(function(){a(m).focus();q.html("")},2E3))}else"report"==
f?(0==c.errCode?(a("#report_comment_"+c.data.commentid).html("").append("<em>24\u5c0f\u65f6\u5185\u7ed9\u60a8\u53cd\u9988\uff0c\u89c1\u6211\u7684\u725b\u8bc4</em>"),a("#report_top_"+c.data.commentid).html("").append("<em>24\u5c0f\u65f6\u5185\u7ed9\u60a8\u53cd\u9988\uff0c\u89c1\u6211\u7684\u725b\u8bc4</em>"),a("#report_msg_"+c.data.commentid).html("").append("<em>24\u5c0f\u65f6\u5185\u7ed9\u60a8\u53cd\u9988\uff0c\u89c1\u6211\u7684\u725b\u8bc4</em>")):12==c.errCode?a("#"+d.reportId).html("").append("<em>\u60a8\u4eca\u5929\u4e3e\u62a5\u7684\u6761\u6570\u5df2\u8fbe\u4e0a\u9650</em>"):
a("#"+d.reportId).html("").append("<em>\u8be5\u8bc4\u8bba\u5df2\u88ab\u4e3e\u62a5\u6216\u5904\u7406!</em>"),a("#"+d.reportId).addClass("np-btn-active"),a(".np-report").remove()):"delete"==f&&0==c.errCode&&a("#post_"+c.data.commentid).animate({height:"0px"},"slow",function(){a(this).remove();k.iframeHeight()});e&&Qoss("hfpljk",this._pubTimer0,{3:e})},encodeHTML:function(a){var c="";if(0==a.length)return"";c=a.replace(/&/g,"&gt;");c=c.replace(/</g,"&lt;");c=c.replace(/>/g,"&gt;");c=c.replace(/ /g,"&nbsp;");
c=c.replace(/\'/g,"&#39;");c=c.replace(/\"/g,"&quot;");return c=c.replace(/\n/g,"<br>")},insertTempComment:function(b,c,e,f,d){var k=this.options;q||getUin();var h=k.$loginFlag.find(".np-user").html(),l=k.$loginFlag.find("img").attr("src"),p="",g="",n=g=p="",s="";k.$loginFlag.find("span:first").hasClass("hyw")?(p=k.$loginFlag.find(".huiyuan").attr("class"),g=p.replace(/[^0-9]/ig,""),p=1,g=parseInt(g),n="hyy",s="huiyuan p"+g):k.$loginFlag.find("span:first").hasClass("hyw0")&&(n="hyy0",s="huiyuan0");
var m="",m=c.replace("<script>","&lt;script&gt;"),m=m.replace("\x3c/script>","&lt;/script&gt;");1==d?(c={id:b,parent:0,time:f,content:c,up:0,userinfo:{userid:a.cookie("uid"),commentnum:"",upnum:0,nick:h,head:l,region:"",hwvip:p,hwlevel:g}},m=this.creatHtml(c,"blueflag",k.$insertFlag)):m='<li class="np-post temporary blueflag" id="comment_'+b+'"><div class="np-tip-newpost"></div><img class="np-avatar" src="'+l+'" alt="\u5934\u50cf"><div class="np-post-body"><div class="np-post-header"><span class="'+
n+'"><a href="javascript:void(0)" class="np-user">'+h+'</a><a href="http://film.qq.com/vip.html?ptag=film_direct.comment" target="_blank" class="'+s+'" title="\u4f1a\u5458\u5c0a\u4eab\u7ea2\u540d\u7279\u6743"></a></span><span class="np-time">\u521a\u521a</span></div><div class="np-post-content"><p>'+m+"</p></div></div></li>";if(0!=parseInt(e)){if(a("#top_"+e).length||a("#comment_"+e).length||a("#post_"+e).length||a("#msg_"+e).length)a("#top_"+e+">ul.children").prepend(m).children("div.pop_reply").hide(),
a("#comment_"+e+">ul.children").prepend(m).children("div.pop_reply").hide(),a("#post_"+e+">ul.children").children("div.pop_reply").hide(),a("#msg_"+e+">ul.children").prepend(m).children("div.pop_reply").hide(),this.iframeHeight()}else a("#allComments .tipInfo:visible")&&a("#allComments .tipInfo").hide(),k.$allComments.find(".np-title-new").length?(k.$allComments.find(".np-title-new").after(m),1!=k.postScroll&&(e=a("#comment_"+b).offset().top+a(top.document).scrollTop(),a(top.document.body).animate({scrollTop:e},
800),a(top.window).scrollTop(e))):k.$allComments.find(".post-list").prepend(m),this.iframeHeight();"post"!=k.$insertFlag?this.blueLine("#"+k.$insertFlag+"_"+b):this.blueLine("#comment_"+b)},iframeHeight:function(){var b=a("#mainBody").height();a(parent.document.body).find("#commentIframe1").length?a(parent.document.body).find("#commentIframe1").height(b):a(parent.document.body).find("#commentIframe").height(b);parent.registerCoralEvent&&parent.registerCoralEvent.iframeHeight&&parent.registerCoralEvent.iframeHeight()},
popupIframeLayer:function(b){a(top.document.body).append('<iframe src ="http://www.qq.com/coral/coralBeta2/coralPopDom2.0.htm" allowTransparency="true"  frameborder="0" scrolling="no" style="width:100%;height:100%;z-index:999999;position:fixed;_position:absolute;*+position:fixed;_left:100px;top:0px;left:0px;border:none;overflow:hidden;" id="np-pop-iframe" data-id = '+b+"></iframe>");a.browser.msie&&"6.0"==a.browser.version&&!a.support.style&&0!=a(top.document.body).find("#np-pop-iframe").length&&
a(top.document.body).find("#np-pop-iframe").css("position","absolute")},bindOtherEvents:function(){var b=this,c=this.options;c.$top_textarea.height(60);c.$top_textarea.css("padding","10px");a("#np-reply-box").delegate("a.change","click",function(){c.changeFlag=1;b.showLoginLayer();sendClientStat(l,1,h,"clk_newreply_notice")});c.$top_textarea.focus(function(){a(this).parent().parent().addClass("checkon")});c.$top_textarea.blur(function(){a(this).parent().parent().removeClass("checkon")});c.$myCowComment.unbind().bind("click",
function(){var e=b.getLoginStatus();sendClientStat(l,1,h,"clk_myniuping");if(0!=e)if(a(this).addClass("np-active"),c.$myAllComment.removeClass("np-active"),c.$allComments.hide(),c.$myComments.show(),a("#mytips").trigger("click"),"none"!=a("#popMsg").css("display"))b.loadMyMessage(),a("#my-message .tipInfo").hide(),a("#popMsg").html("").hide(),a("#mytips").trigger("click");else if(a(this).hasClass("np-active"))""==a("#popMsg").html()?0<=a("#my-message-list li").length||a("#popMsg").html("").hide():
(a("#my-message-list").html(""),a("#popMsg").html("").hide(),b.loadMyMessage());else{if(a(this).hasClass("np-active"))"none"!=a("#popMsg").css("display")&&(a("#my-message-list").html(""),b.loadMyMessage(),a("#popMsg").html("").hide());else if(a("#my-message-list li").length)"none"!=a("#popMsg").css("display")&&(a("#my-message-list").html(""),a("#popMsg").html("").hide(),b.loadMyMessage());else return;b.checkAndPublish(this.id)}else c.centerFlag=1,a("#my-message .tipInfo").hide(),a("#my-notification .tipInfo").hide(),
b.showLoginLayer()});c.$myAllComment.unbind().bind("click",function(){a(this).addClass("np-active");c.$myCowComment.removeClass("np-active");c.$allComments.show();c.$myComments.hide();b.iframeHeight()})},formatTime:function(a){var c=this.options.$nowDate/1E3-a;if(1>c)return"\u521a\u521a";if(60>c)return Math.floor(c)+"\u79d2\u949f\u524d";if(3600>c)return Math.floor(c/60)+"\u5206\u949f\u524d";if(86400>c)return Math.floor(c/3600)+"\u5c0f\u65f6\u524d";if(604800>c)return Math.floor(c/86400)+"\u5929\u524d";
a=new Date(1E3*a);c=a.getFullYear()+"-";c+=a.getMonth()+1+"-";return c+=a.getDate()},conHeight:function(b){var c=a("#allComments .np-post .np-post-content[data-height!=5]"),e=24;a("#allComments .np-post .np-post-content").length&&(/px/.test(c.css("line-height"))&&(e=c.css("line-height").split("px")[0]),2==b&&(c=a("#my-message-list .np-post .np-post-content[data-height!=5] p")),3==b&&(c=a("#my-notification-list .np-post .np-post-content[data-height!=5]")),5==b&&(c=a("#allComments .topIco .np-post-content[data-height!=5]")),
c.each(function(b,c){a(this).attr("data-height","5");a(this).height()>6*e&&!a(this).next(".spreadMoreBtn").length&&(a(this).css({height:5*e,overflow:"hidden"}),a(this).after('<a href="javascript:void(0)" class="spreadMoreBtn np-btn np-btn-spread"><i class="np-icon np-icon-spread"></i></a>'))}))},updateTime:function(){var b=this;this.options.$content.find(".uptime").each(function(){a(this).html(b.formatTime(a(this).attr("date")))});a("#my-message").find(".time").each(function(){a(this).html(b.formatTime(a(this).attr("date")))});
a("#my-notification").find(".post-time span").each(function(){a(this).html(b.formatTime(a(this).attr("date")))});a("#hiddenCon").find(".uptime").each(function(){a(this).html(b.formatTime(a(this).attr("date")))})},subString:function(a,c){a=a||"";var e=/[^\x00-\xff]/g;if(a.replace(e,"mm").length<=c)return a;for(var f=Math.floor(c/2);f<a.length;f++)if(a.substr(0,f).replace(e,"mm").length>=c)return a.substr(0,f)+"...";return a},myCreateHtml:function(b,c,e){var f=this.options,d="",k="",h="",g="msg_",l=
"v_qq_com.comment";1==this.options.film&&(l="film_direct.comment");var n="",q=f.popupInfo,n='<a href="#" class="np-link-weak"href="'+(b.targetinfo?b.targetinfo.url:"")+'">'+b.targetinfo.title+"</a>",s="",m="",g="";0!=b.repnum&&(g=this.creatPostLink(b));var t="<p>"+b.content.replace(/\n/g,"<br />")+g+"</p>";void 0!=b.picture&&b.picture.length&&(t="<p>"+b.content.replace(/\n/g,"<br />")+'</p><div><img class="np-con-img" src="'+b.picture[0].url+'/150" />'+g+"</div>");if("message"==c){"4"==b.tipstype&&
(0<b.userlist.length&&(a.each(b.userlist,function(a,b){1==f.huiyuan&&1==b.hwvip&&(s="hyy",m="huiyuan p"+b.hwlevel);0<a&&(h+="\u3001");h+='<span class="'+s+'"><a href="javascript:void(0)" post_uid='+b.userid+'  class="np-user '+q+'">'+b.nick+'</a><a href="http://film.qq.com/vip.html?ptag='+l+'" target = "_blank" class="'+m+'"></a></span>'}),b.userlist.length<b.up&&(h+="\u7b49")),d='<li class="post np-post '+e+'" id="msg_'+b.id+'" tid="'+b.targetinfo.targetid+'"><div class="np-post-header"><span class="np-avatar np-avatar-upvote"></span>'+
h+b.up+'\u9876\u4e86\u4f60\u7684\u8bc4\u8bba\uff1a<span class="np-text-strong">'+(""==a.trim(b.content)?"\u53d1\u8868\u4e86\u4e00\u5f20\u56fe\u7247":this.subString(b.content,46))+this.creatPostLink(b)+'</span><span class="np-time" date="'+b.tipstime+'">'+this.formatTime(b.tipstime)+'</span></div><div class="np-post-content"><a class="np-link-weak" target="_blank" href="'+(b.targetinfo?b.targetinfo.url:"")+'">'+b.targetinfo.title+'</a></div><div class="np-post-footer"></div><ul class="children"></ul></li>');
"3"==b.tipstype&&(1==f.huiyuan&&1==b.userinfo.hwvip&&(s="hyy",m="huiyuan p"+b.userinfo.hwlevel),b.userinfo.head&&(k=b.userinfo.head.replace(/140/,"40")||"http://t0.qlogo.cn/mbloghead/01676c4b10bbdb6f2618/50"),d+='<li class="np-post '+e+'" id="msg_'+b.id+'" tid="'+b.targetinfo.targetid+'"><div class="np-post-body"><div class="np-post-header"><img class="np-avatar '+q+'"  post_uid="'+b.userinfo.userid+'" src="'+k+'" alt="\u5934\u50cf"><span class="'+s+'"><a href="javascript:void(0)" class="np-user '+
q+'" post_uid="'+b.userinfo.userid+'">'+b.userinfo.nick+'</a><a href="http://film.qq.com/vip.html?ptag='+l+'" target = "_blank" class="'+m+'"></a></span>\u56de\u590d\u4e86\u4f60\u7684\u8bc4\u8bba<span class="np-text-strong">'+this.subString(b.parentinfo.content,46)+this.creatPostLink(b.parentinfo)+'</span><span class="np-time" date="'+b.tipstime+'">'+this.formatTime(b.tipstime)+'</span><a class="np-btn np-btn-report report" id="report_msg_'+b.id+'">\u4e3e\u62a5</a></div><div class="np-post-content">'+
t+'<a class="np-link-weak" target="_blank" href="'+(void 0!=b.targetinfo?b.targetinfo.url:"")+'">'+b.targetinfo.title+'</a></div><div class="np-post-footer"><a href="javascript:void(0)" class="np-btn np-btn-upvote upvote" id="am_'+b.id+'">(<em>'+b.up+'</em>)</a><a href="javascript:void(0)" class="np-btn np-btn-reply reply">\u56de\u590d</a></div></div><ul class="children"></ul></li>');"6"==b.tipstype&&(d+='<li class="np-post '+e+'" id="msg_'+b.id+'" tid="'+b.targetinfo.targetid+'">',d+='<div class="np-post-body"><div class="np-post-header">',
d+='<img class="np-avatar '+q+'"  post_uid="'+b.userinfo.userid+'" src="http://t0.qlogo.cn/mbloghead/01676c4b10bbdb6f2618/50" alt="\u5934\u50cf">',d+='\u6587\u7ae0<a href="javascript:void(0)" style="cursor:default">'+b.targetinfo.title+'</a>\u5f15\u7528\u4e86\u4f60\u7684\u8bc4\u8bba<span class="np-text-strong">'+this.subString(b.content,46)+"</span>",d+='<span class="np-time" date="'+b.tipstime+'">'+this.formatTime(b.tipstime)+"</span>",d+="</div>",d+='<div class="np-post-content">',d+='<a class="np-link-weak" target="_blank" href="'+
(b.targetinfo?b.targetinfo.url:"")+'">'+b.targetinfo.title+"</a>",d+="</div>",d+='<div class="np-post-footer">',d+="</div></div>",d+='<ul class="children"></ul>',d+="</li>");var v,k=" ";b.targetinfo&&(v=b.targetinfo.url||"",k=b.targetinfo.title||"");"5"==b.tipstype&&(d+='<li class="post np-post '+e+'">',d+='<div class="np-post-header">',d+='<span class="np-avatar np-avatar-report"></span>',d+='\u4f60\u4e3e\u62a5\u4e86<a href="javascript:void(0)" post_uid='+b.userinfo.userid+'  class="np-user '+q+
'">'+(""!=b.userinfo.nick?b.userinfo.nick:"\u7f51\u53cb")+"</a>",d+='\u7684\u8bc4\u8bba\uff1a<span class="np-text-strong">'+this.subString(b.content,46)+"</span>",d+='<span class="np-time time" date="'+b.tipstime+'">'+this.formatTime(b.tipstime)+"</span>",d+="</div>",d+='<div class="np-post-content">',d+='<div class="message-content">',d+="<div>"+(2==b.checkstatus?"\u7ecf\u5ba1\u6838\u88ab\u5220\u9664":"\u7ecf\u5ba1\u6838\u4e3e\u62a5\u65e0\u6548")+"</div>",d+="</div>",d+='<a class="np-link-weak" target="_blank"  href="'+
v+'">'+k,d+='</a></div><div class="np-post-footer"></div></li>');b.userinfo.head&&b.userinfo.head.replace(/140/,"40")}"myComment"==c&&(g="post_",c="",c=0!=b.parent&&b.parentinfo?"<div>\u56de\u590d\u4e86<a post_uid="+b.parentinfo.userinfo.userid+' href="javascript:void(0)" class="np-user '+q+'">'+b.parentinfo.userinfo.nick+'</a>\u7684\u8bc4\u8bba<span class="np-text-strong">'+this.subString(b.parentinfo.content,46)+"</span></div>":"\u53d1\u8868\u8bc4\u8bba",n='<a href="'+b.targetinfo.url+'" target = "_blank" class="np-link-weak">'+
(b.targetinfo.title?b.targetinfo.title:" ")+"</a>",d='<li class="np-post" id='+g+""+b.id+" tid="+b.targetinfo.targetid+'><div class="np-post-body"><div class="np-post-header"><span class="np-time">'+(b.time?this.formatTime(b.time):"\u521a\u521a")+"</span>"+c+'</div><div class="np-post-content">'+t+n+'</div><div class="np-post-footer"><span class="np-btn-upvote">'+b.up+'</span><span class="np-btn-reply reply">'+b.repnum+'</span><span class="np-btn-delete delete" id=delete_'+b.id+'>\u5220\u9664</span></div></div><ul class="children"></ul></li>');
return d},loadMyMessage:function(){var b=this,c=this.options,e=c.$urlapi,f="",d=c.centerPageSize,h=1;1==c.$urlapi.pageflag&&(d=20,h=2);a.ajax({url:c.fetchUrl+"user/"+c.$urlapi.userId+"/msg?msgid="+c.$urlapi.msgid+"&pageflag="+c.$urlapi.pageflag+"&reqnum="+d,dataType:"jsonp",beforeSend:function(){b._tips0=(new Date).getTime()},success:function(g){var l=(new Date).getTime();if(8==g.errCode)b.showLoginLayer();else{if(0==g.errCode){if(0==e.pageflag&&(e.msgid=e.first=g.data.first,e.last=g.data.last,a("#my-message-list").html(""),
g.data.retnum<g.data.total&&10==g.data.retnum&&a("#loadMsgMore").show(),0==g.data.retnum)){a("#my-message").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u63d0\u9192").show();a("#loadMsgMore").hide();return}1==e.pageflag&&(e.msgid=e.last=g.data.last);var p="";2==e.pageflag&&(e.msgid=e.first=g.data.first,p="blueflag");a.each(g.data.message,function(a,c){f+=b.myCreateHtml(c,"message",p)});1==c.$urlapi.pageflag?(a("#my-message-list").append(f),b.iframeHeight()):(a("#my-message-list").prepend(f),
b.iframeHeight(),a("#my-message-list .blueflag").each(function(c,e){b.blueLine("#"+a(this).attr("id"))}));2==h&&b.conHeight(2);b.iframeHeight();g.data.retnum<d||g.data.total<=d?(a("#loadMsgMore>span").hide(),a("#loadMsgMore>em").removeClass("np-load-more-loading")):(a("#loadMsgMore>span").show(),a("#loadMsgMore>em").hide());a("#my-message").children(".tipInfo").hide();b.iframeHeight()}else 0==g.errCode&&0==g.data.retnum?0==a("#my-message-list li").length?a("#my-message").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u63d0\u9192").show():
a("#my-message").children(".tipInfo").hide():(a("#my-message").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u63d0\u9192").show(),a("#loadMsgMore").hide());Qoss("wdtx",b._tips0,{1:b._tips0+1,2:l,3:l},100)}}})},loadMyComment:function(){var b=this,c=this.options,e=c.centerPageSize;0==c.$urlapi_mycomment.pageflag&&(c.$urlapi_mycomment.last=0);1==c.$urlapi_mycomment.pageflag&&(e=20);a.ajax({url:c.fetchUrl+"user/"+c.$urlapi_mycomment.userId+"/comment?lastid="+c.$urlapi_mycomment.last+
"&pageflag="+c.$urlapi_mycomment.pageflag+"&reqnum="+e,dataType:"jsonp",jsonpCallback:"myComment",beforeSend:function(){b._myCom0=(new Date).getTime()},success:function(f){var d="";if(8==f.errCode)b.showLoginLayer();else{if(0==f.errCode){var h=(new Date).getTime(),g=f.data.usermeta.region.replace(/:/g," "),g=""!=a.trim(g)?g:"\u817e\u8baf\u7f51\u53cb";1==c.huiyuan&&1==f.data.usermeta.hwvip&&(a("#myuserInfo").find("span:first").addClass("hyw"),a("#myuserInfo .hyw a").addClass("huiyuan p"+f.data.usermeta.hwlevel),
1==c.film&&a("#myuserInfo .hyw a").attr("href","http://film.qq.com/vip.html?ptag=film_direct.comment"));a("#myuserInfo").find("img").attr("src",f.data.usermeta.head||"");a("#myuserInfo").find(".np-user").html(f.data.usermeta.nick);a("#myuserInfo").find(".a").html(g);a("#myuserInfo").find(".b").html(f.data.usermeta.upnum);a("#myuserInfo").find(".c").html(f.data.usermeta.commentnum);a("#myuserInfo").show();if(0==c.$urlapi_mycomment.pageflag&&(c.$urlapi_mycomment.msgid=c.$urlapi_mycomment.first=f.data.first,
c.$urlapi_mycomment.last=f.data.last,a("#my-notification-list").html(""),10==f.data.retnum&&a("#loadCmtMore").show(),0==f.data.retnum)){a("#my-notification").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u8bc4\u8bba").show();a("#loadCmtMore").hide();a("#myuserInfo").hide();b.iframeHeight();return}1==c.$urlapi_mycomment.pageflag&&(c.$urlapi_mycomment.last=f.data.last);a.each(f.data.comments,function(a,c){d+=b.myCreateHtml(c,"myComment")});a("#my-notification-list").append(d);b.conHeight(2);
b.iframeHeight();setTimeout(function(){b.iframeHeight()},200);f.data.retnum<e||f.data.total<=e?(a("#loadCmtMore>span").hide(),a("#loadCmtMore>em").removeClass("np-load-more-loading")):(a("#loadCmtMore>span").show(),a("#loadCmtMore>em").hide());a("#my-notification").children(".tipInfo").hide()}else a("#my-notification").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u8bc4\u8bba").show(),a("#loadCmtMore").hide(),0==a("#my-notification-list li").length&&a("#my-notification").children(".tipInfo").show(),
b.iframeHeight();Qoss("wdpl",b._myCom0,{1:b._myCom0+1,2:h,3:h},100)}}})},clickLoadMore:function(){var b=this,c=this.options;a("#loadMsgMore>span").click(function(){a("#loadMsgMore>span").hide();a("#loadMsgMore>em").addClass("np-load-more-loading").show();c.$urlapi.pageflag=1;c.$urlapi.msgid=c.$urlapi.last;b.loadMyMessage();sendClientStat(l,1,h,"clk_notice_more")});a("#loadCmtMore>span").click(function(){a("#loadCmtMore>span").hide();a("#loadCmtMore>em").addClass("np-load-more-loading").show();c.$urlapi_mycomment.pageflag=
1;c.$urlapi_mycomment.msgid=c.$urlapi_mycomment.last;b.loadMyComment();sendClientStat(l,1,h,"clk_mycomment_more")})},creatPostLink:function(a){return""},initPostFrame:function(){var b=this,c=this.options;a("#content").delegate("."+c.popupLink,"click",function(c){c=b.options.$loginFlag.data("nick");var f=b.options.$loginFlag.data("userPic"),d=a(this),g=d.attr("targetid"),n=d.attr("commentid"),d=d.attr("parentid");a(top.document.body).append('<iframe src="http://www.qq.com/coral/postframe/postframe.htm?'+
(new Date).getDate()+'" id="np-pop-iframe" allowtransparency="true" frameborder="0" scrolling="no" style="width: 100%; z-index: 9999; position: fixed; top: 0px; left: 0px; border: none; overflow: hidden; height: 100%;" data-nick="'+c+'" data-pic="'+f+'" data-id="'+g+"_"+n+'" parentid="'+d+'"></iframe>');sendClientStat(l,1,h,"clk_comment_context")})}});g.comment()})(jQuery)});String.prototype.realLength=function(){return this.replace(/[^\x00-\xff]/g,"**").length};
function topCallback(a){jQuery(document).comment("pubCallback","top",a,(new Date).getTime())}function popCallback(a){jQuery(document).comment("pubCallback","pop",a,(new Date).getTime())}function reportCallback(a){jQuery(document).comment("pubCallback","report",a,(new Date).getTime())}function deleteCallback(a){jQuery(document).comment("pubCallback","delete",a,(new Date).getTime())}
function getUin(){var a="";if(jQuery.cookie("uin")){if(a=jQuery.cookie("uin"),a.match(/[1-9][0-9]*/)instanceof Array)return a.match(/[1-9][0-9]*/)[0]}else return a=jQuery.cookie("luin")}function getKey(){return jQuery.cookie("skey")||jQuery.cookie("lskey")}function generateToken(a){var g=2013;if(a)for(var n=0,q=a.length;n<q;n++)g+=(g<<5)+a.charCodeAt(n);return g&2147483647}
function publicLoginEvent(){parent.registerCoralEvent&&parent.registerCoralEvent.loginEvent?parent.registerCoralEvent.loginEvent():0!=jQuery(parent.document.getElementById("oneKey")).length?jQuery(parent.document.getElementById("oneKey")).click():jQuery(parent.document.getElementById("onekey")).click()}
function publicLogined(a,g,n){a&&(jQuery(document).comment("loginEvent",a,g,n),top.document.getElementById("np-pop-iframe")&&top.document.getElementById("np-pop-iframe").contentWindow.publicLogined(a,g,n))}function publicLogout(){jQuery(document).comment("loginOut")}
function Qoss(a,g,n,q){for(var h in n)n[h]-=g;jQuery('<img src="http://qos.report.qq.com/collect?type=1&name=coral_qq_com_'+a+"&"+jQuery.param(n)+'">').error(function(){jQuery(this).remove()}).load(function(){jQuery(this).remove()}).appendTo("body")}
function sendClientStat(a,g,n,q,h){var l=location.protocol+"//"+location.host+location.pathname,b=parseInt(1E9*Math.random()),c=getUin()||"",e=jQuery.cookie("uid"),f=encodeURIComponent(location.host);if("coral"==a)if(1==g){g=1836;var d="coral.web.comment_detail.action"}else g=1837,d="coral.web.comment_detail.pgv";else 1==g?(g=1836,d="coral.web.article_detail.action"):(g=1837,d="coral.web.article_detail.pgv");h=h||0;g_btrace_BOSS=new Image(1,1);g_btrace_BOSS.src="http://btrace.qq.com/collect?sIp=0&iQQ="+
c+"&sBiz="+d+"&sOp="+q+"&iSta="+h+"&iTy="+g+"&iFlow="+b+"&isite="+a+"&iTargetid="+n+"&iuid="+e+"&iUrl="+l+"&idomain="+f};/*  |xGv00|f3ae3d4375f77a3411386fb1e89e6d58 */